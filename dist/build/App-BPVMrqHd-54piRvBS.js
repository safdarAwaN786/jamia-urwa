import{j as t,P as V,d as N,R as Ne,e as te,A as Fe,L as ne,B as Oe,f as O,T as k,g as y,r as m,p as P,h as Me,k as z,l as Le,m as $e,n as X,o as S,q as v,s as De,t as Ye,v as He,w as ae,x as R,V as re,y as A,C as Ke,z as Ue}from"./strapi-DszYkmQ4.js";var $=function(){return $=Object.assign||function(a){for(var r,o=1,s=arguments.length;o<s;o++){r=arguments[o];for(var i in r)Object.prototype.hasOwnProperty.call(r,i)&&(a[i]=r[i])}return a},$.apply(this,arguments)};function ie(e,a){var r={};for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&a.indexOf(o)<0&&(r[o]=e[o]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var s=0,o=Object.getOwnPropertySymbols(e);s<o.length;s++)a.indexOf(o[s])<0&&Object.prototype.propertyIsEnumerable.call(e,o[s])&&(r[o[s]]=e[o[s]]);return r}var le={exports:{}},c={};/** @license React v16.13.1
 * react-is.development.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var oe;function Be(){return oe||(oe=1,function(){var e=typeof Symbol=="function"&&Symbol.for,a=e?Symbol.for("react.element"):60103,r=e?Symbol.for("react.portal"):60106,o=e?Symbol.for("react.fragment"):60107,s=e?Symbol.for("react.strict_mode"):60108,i=e?Symbol.for("react.profiler"):60114,l=e?Symbol.for("react.provider"):60109,f=e?Symbol.for("react.context"):60110,d=e?Symbol.for("react.async_mode"):60111,C=e?Symbol.for("react.concurrent_mode"):60111,g=e?Symbol.for("react.forward_ref"):60112,T=e?Symbol.for("react.suspense"):60113,w=e?Symbol.for("react.suspense_list"):60120,E=e?Symbol.for("react.memo"):60115,b=e?Symbol.for("react.lazy"):60116,p=e?Symbol.for("react.block"):60121,I=e?Symbol.for("react.fundamental"):60117,D=e?Symbol.for("react.responder"):60118,Y=e?Symbol.for("react.scope"):60119;function H(n){return typeof n=="string"||typeof n=="function"||n===o||n===C||n===i||n===s||n===T||n===w||typeof n=="object"&&n!==null&&(n.$$typeof===b||n.$$typeof===E||n.$$typeof===l||n.$$typeof===f||n.$$typeof===g||n.$$typeof===I||n.$$typeof===D||n.$$typeof===Y||n.$$typeof===p)}function x(n){if(typeof n=="object"&&n!==null){var B=n.$$typeof;switch(B){case a:var L=n.type;switch(L){case d:case C:case o:case i:case s:case T:return L;default:var ee=L&&L.$$typeof;switch(ee){case f:case g:case b:case E:case l:return ee;default:return B}}case r:return B}}}var h=d,u=C,F=f,K=l,U=a,_=g,pe=o,he=b,ge=E,xe=r,Ce=i,ve=s,ye=T,J=!1;function Te(n){return J||(J=!0,console.warn("The ReactIs.isAsyncMode() alias has been deprecated, and will be removed in React 17+. Update your code to use ReactIs.isConcurrentMode() instead. It has the exact same API.")),Q(n)||x(n)===d}function Q(n){return x(n)===C}function Ee(n){return x(n)===f}function be(n){return x(n)===l}function _e(n){return typeof n=="object"&&n!==null&&n.$$typeof===a}function je(n){return x(n)===g}function Se(n){return x(n)===o}function Re(n){return x(n)===b}function Ae(n){return x(n)===E}function Pe(n){return x(n)===r}function we(n){return x(n)===i}function Ie(n){return x(n)===s}function ke(n){return x(n)===T}c.AsyncMode=h,c.ConcurrentMode=u,c.ContextConsumer=F,c.ContextProvider=K,c.Element=U,c.ForwardRef=_,c.Fragment=pe,c.Lazy=he,c.Memo=ge,c.Portal=xe,c.Profiler=Ce,c.StrictMode=ve,c.Suspense=ye,c.isAsyncMode=Te,c.isConcurrentMode=Q,c.isContextConsumer=Ee,c.isContextProvider=be,c.isElement=_e,c.isForwardRef=je,c.isFragment=Se,c.isLazy=Re,c.isMemo=Ae,c.isPortal=Pe,c.isProfiler=we,c.isStrictMode=Ie,c.isSuspense=ke,c.isValidElementType=H,c.typeOf=x}()),c}le.exports=Be();var Ve=le.exports,ce=Ve,We={$$typeof:!0,render:!0,defaultProps:!0,displayName:!0,propTypes:!0},qe={$$typeof:!0,compare:!0,defaultProps:!0,displayName:!0,propTypes:!0,type:!0},de={};de[ce.ForwardRef]=We;de[ce.Memo]=qe;function ze(e,a,r){if(r===void 0&&(r=Error),!e)throw new r(a)}var Xe=function(e){console.error(e)},Ge=function(e){console.warn(e)},Ze={formats:{},messages:{},timeZone:void 0,defaultLocale:"en",defaultFormats:{},fallbackOnEmptyString:!0,onError:Xe,onWarn:Ge};function Je(e){ze(e,"[React Intl] Could not find required `intl` object. <IntlProvider> needs to exist in the component ancestry.")}$($({},Ze),{textComponent:m.Fragment});var G=typeof window<"u"&&!window.__REACT_INTL_BYPASS_GLOBAL_CONTEXT__?window.__REACT_INTL_CONTEXT__||(window.__REACT_INTL_CONTEXT__=m.createContext(null)):m.createContext(null);G.Consumer;G.Provider;var Qe=G;function Z(){var e=m.useContext(Qe);return Je(e),e}var W;(function(e){e.formatDate="FormattedDate",e.formatTime="FormattedTime",e.formatNumber="FormattedNumber",e.formatList="FormattedList",e.formatDisplayName="FormattedDisplayName"})(W||(W={}));var q;(function(e){e.formatDate="FormattedDateParts",e.formatTime="FormattedTimeParts",e.formatNumber="FormattedNumberParts",e.formatList="FormattedListParts"})(q||(q={}));function ue(e){var a=function(r){var o=Z(),s=r.value,i=r.children,l=ie(r,["value","children"]),f=typeof s=="string"?new Date(s||0):s,d=e==="formatDate"?o.formatDateToParts(f,l):o.formatTimeToParts(f,l);return i(d)};return a.displayName=q[e],a}function M(e){var a=function(r){var o=Z(),s=r.value,i=r.children,l=ie(r,["value","children"]),f=o[e](s,l);if(typeof i=="function")return i(f);var d=o.textComponent||m.Fragment;return m.createElement(d,null,f)};return a.displayName=W[e],a}M("formatDate");M("formatTime");M("formatNumber");M("formatList");M("formatDisplayName");ue("formatDate");ue("formatTime");const j=()=>{const{formatMessage:e}=Z();return{i18n:(r,o)=>e({id:`${P}.${r}`,defaultMessage:o})}};function fe(){const{toggleNotification:e}=Ye(),{i18n:a}=j();function r({type:s="info",message:i=a("plugin.message.something","Something occurred in Meilisearch"),link:l,blockTransition:f=!0,title:d}){e({title:d,type:s,message:a("notification.meilisearch.message",i),link:l,blockTransition:f,onClose:()=>localStorage.setItem("STRAPI_UPDATE_NOTIF","true")})}return{handleNotification:r,checkForbiddenError:({response:s})=>{const i=s?.data?.error?.status;i&&i===403&&r({title:a("plugin.message.forbidden.title","Forbidden"),type:"warning",message:a("plugin.message.forbidden.description","You do not have permission to do this action"),blockTransition:!1})}}}function et(){const[e,a]=m.useState([]),[r,o]=m.useState(!0),[s,i]=m.useState(!1),[l,f]=m.useState(!1),{handleNotification:d,checkForbiddenError:C}=fe(),{i18n:g}=j(),{get:T,del:w,post:E,put:b}=z(),p=()=>o(h=>!h),I=({indexed:h,listened:u})=>h&&u?g("plugin.table.td.hookingText.hooked","Hooked"):!h&&!u?"/":g("plugin.table.td.hookingText.reload","Reload needed"),D=async()=>{try{const{data:{data:h,error:u}}=await T(`/${P}/content-type/`);if(u)d({type:"warning",message:u.message,link:u.link});else{const F=h.contentTypes.map(_=>(_.reloadNeeded=I({indexed:_.indexed,listened:_.listened}),_)),K=F.find(_=>_.reloadNeeded===g("plugin.table.td.hookingText.reload","Reload needed")),U=F.find(_=>_.isIndexing===!0);f(!!U),i(!!K),a(F)}}catch(h){C(h)}},Y=async({contentType:h})=>{try{const{data:{error:u}}=await w(`/${P}/content-type/${h}`);u?d({type:"warning",message:u.message,link:u.link}):(p(),d({type:"success",message:g("plugin.message.success.delete","Request to delete content-type is successful"),blockTransition:!1}))}catch(u){C(u)}},H=async({contentType:h})=>{try{const{data:{error:u}}=await E(`/${P}/content-type`,{contentType:h});console.log(u),u?d({type:"warning",message:u.message,link:u.link}):(p(),d({type:"success",message:g("plugin.message.success.add","Request to add a content-type is successful"),blockTransition:!1}))}catch(u){C(u)}},x=async({contentType:h})=>{try{const{data:{error:u}}=await b(`/${P}/content-type`,{contentType:h});u?d({type:"warning",message:u.message,link:u.link}):(p(),d({type:"success",message:g("plugin.message.success.update","Request to update content-type is successful"),blockTransition:!1}))}catch(u){C(u)}};return m.useEffect(()=>{D()},[r]),m.useEffect(()=>{let h;return l?h=setInterval(()=>{p()},1e3):clearInterval(h),()=>clearInterval(h)},[l]),{collections:e,deleteCollection:Y,addCollection:H,updateCollection:x,reloadNeeded:s,refetchCollection:p,handleNotification:d}}const tt=({entry:e,deleteCollection:a,addCollection:r,updateCollection:o})=>{const{i18n:s}=j(),{allowedActions:{canCreate:i,canUpdate:l,canDelete:f}}=O(N.collections);return t.jsxs(ae,{children:[(i||f)&&t.jsx(A,{children:t.jsx(Ke,{"aria-label":`Select ${e.collection}`,onCheckedChange:()=>{e.indexed?a({contentType:e.contentType}):r({contentType:e.contentType})},checked:e.indexed})}),t.jsx(A,{children:t.jsx(v,{textColor:"neutral800",children:e.collection})}),t.jsx(A,{children:t.jsx(v,{textColor:"neutral800",children:e.indexed?s("plugin.table.td.yes","Yes"):s("plugin.table.td.no","No")})}),t.jsx(A,{children:t.jsx(v,{textColor:"neutral800",children:e.isIndexing?s("plugin.table.td.yes","Yes"):s("plugin.table.td.no","No")})}),t.jsx(A,{children:t.jsx(v,{textColor:"neutral800",children:e.indexUid})}),t.jsx(A,{children:t.jsxs(v,{textColor:"neutral800",children:[e.numberOfDocuments," / ",e.numberOfEntries]})}),t.jsx(A,{children:t.jsx(v,{textColor:"neutral800",children:e.reloadNeeded})}),l&&t.jsx(A,{children:t.jsx(Ue,{children:t.jsx(y,{paddingLeft:1,children:e.indexed&&t.jsx(X,{onClick:()=>o({contentType:e.contentType}),size:"S",variant:"secondary",children:s("plugin.update","Update")})})})})]},e.contentType)},nt=m.memo(tt),rt=()=>{const{i18n:e}=j(),{allowedActions:{canCreate:a,canUpdate:r,canDelete:o}}=O(N.collections);return t.jsx(He,{children:t.jsxs(ae,{children:[(a||o)&&t.jsx(R,{children:t.jsx(re,{children:"INDEX"})}),t.jsx(R,{children:t.jsx(v,{variant:"sigma",children:e("plugin.table.header.name","NAME")})}),t.jsx(R,{children:t.jsx(v,{variant:"sigma",children:e("plugin.table.header.in-meilisearch","IN MEILISEARCH ?")})}),t.jsx(R,{children:t.jsx(v,{variant:"sigma",children:e("plugin.table.header.indexing","INDEXING ?")})}),t.jsx(R,{children:t.jsx(v,{variant:"sigma",children:e("plugin.table.header.index-name","INDEX NAME")})}),t.jsx(R,{children:t.jsx(v,{variant:"sigma",children:e("plugin.table.header.documents","DOCUMENTS")})}),t.jsx(R,{children:t.jsx(v,{variant:"sigma",children:e("plugin.table.header.hooks","HOOKS")})}),r&&t.jsx(R,{children:t.jsx(re,{children:"Actions"})})]})})},ot=m.memo(rt),se="did-not-kill-server",st="server is down";function me(e,a){return new Promise(r=>{fetch(`${window.strapi.backendURL}/_health`,{method:"HEAD",mode:"no-cors",headers:{"Content-Type":"application/json","Keep-Alive":"false"}}).then(o=>{if(o.status>=400)throw new Error(st);if(!a)throw new Error(se);r(e)}).catch(o=>{setTimeout(()=>me(e,o.message!==se).then(r),100)})})}const at=()=>{const{collections:e,deleteCollection:a,addCollection:r,updateCollection:o,reloadNeeded:s,refetchCollection:i}=et(),{lockAppWithAutoreload:l,unlockAppWithAutoreload:f}=Me(),{get:d}=z(),[C,g]=m.useState(!1),{i18n:T}=j(),w=6,E=10,b=async()=>{try{l(),await d(`/${P}/reload`,!0),await me(!0),g(!1)}catch(p){console.error(p)}finally{f(),i()}};return m.useEffect(()=>{C&&b()},[C]),t.jsxs(y,{background:"neutral100",children:[t.jsxs(Le,{colCount:E,rowCount:w,children:[t.jsx(ot,{}),t.jsx($e,{children:e.map(p=>t.jsx(nt,{entry:p,deleteCollection:a,addCollection:r,updateCollection:o},p.collection))})]}),s&&t.jsx(y,{padding:5,children:t.jsx(X,{onClick:()=>g(!0),children:T("plugin.reload-server","Reload server")})})]})},it=m.memo(at);function lt(){const[e,a]=m.useState({host:"",apiKey:"",ApiKeyIsFromConfigFile:!0,HostIsFromConfigFile:!0}),[r,o]=m.useState(!0),[s,i]=m.useState(""),[l,f]=m.useState(""),{handleNotification:d}=fe(),{i18n:C}=j(),{get:g,post:T}=z(),w=()=>o(p=>!p),E=async()=>{const{data:{error:p}}=await T(`/${P}/credential`,{apiKey:l,host:s});p?d({type:"warning",message:p.message,link:p.link}):(w(),d({type:"success",message:C("plugin.message.success.credentials","Credentials sucessfully updated!"),blockTransition:!1}))},b=async()=>{const{data:{data:p,error:I}}=await g(`/${P}/credential`);I?d({type:"warning",message:I.message,link:I.link}):(a(p),i(p.host),f(p.apiKey))};return m.useEffect(()=>{b()},[r]),{credentials:e,updateCredentials:E,setHost:i,setApiKey:f,host:s,apiKey:l}}const ct=()=>{const{host:e,apiKey:a,credentials:r,setHost:o,setApiKey:s,updateCredentials:i}=lt(),{i18n:l}=j(),{allowedActions:{canEdit:f}}=O(N.settingsEdit);return t.jsxs(y,{children:[t.jsx(y,{padding:2,children:t.jsxs(S.Root,{id:"host",hint:l("plugin.tab.settings.input.url.hint","The URL on which your Meilisearch is running"),children:[t.jsx(S.Label,{children:l("plugin.tab.settings.input.url.label","Meilisearch URL")}),t.jsx(S.Input,{type:"text",name:"host",value:e,placeholder:l("plugin.tab.settings.input.url.placeholder","URL"),onChange:d=>o(d.target.value),disabled:r.HostIsFromConfigFile}),t.jsx(S.Hint,{})]})}),t.jsx(y,{padding:2,children:t.jsxs(S.Root,{id:"apiKey",hint:l("plugin.tab.settings.input.apiKey.hint","A valid API key with enough permission to create indexes (or the master key)."),children:[t.jsx(S.Label,{children:l("plugin.tab.settings.input.apiKey.label","Meilisearch API Key")}),t.jsx(S.Input,{type:"password",name:"apiKey",placeholder:l("plugin.tab.settings.input.apiKey.placeholder","API key"),value:a,onChange:d=>s(d.target.value),disabled:r.ApiKeyIsFromConfigFile}),t.jsx(S.Hint,{})]})}),t.jsx(y,{paddingTop:1,paddingLeft:2,children:t.jsxs(v,{variant:"pi",style:{color:"red"},children:[l("plugin.tab.settings.warning.credentials.1","Do not use this API key on your front-end as it has too much rights. Instead, use the public key available using")," ",t.jsx(De,{isExternal:!0,href:"https://www.meilisearch.com/docs/reference/api/keys#get-keys",children:t.jsx(v,{variant:"pi",style:{color:"red"},children:l("plugin.tab.settings.warning.credentials.2","the key route")})}),"."]})}),t.jsx(y,{paddingTop:2,paddingLeft:2,paddingRight:2,paddingBottom:2,children:f&&t.jsx(X,{variant:"secondary",onClick:()=>i(),disabled:r.ApiKeyIsFromConfigFile&&r.HostIsFromConfigFile,children:l("plugin.save","Save")})})]})},dt=m.memo(ct),ut=()=>t.jsx(y,{padding:5,children:t.jsx(dt,{})}),ft=()=>{const{i18n:e}=j(),{allowedActions:a}=O(N.collections),{allowedActions:r}=O(N.settings),o=Object.values(a).some(i=>!!i),s=Object.values(r).some(i=>!!i);return t.jsxs(k.Root,{defaultValue:"collections",children:[t.jsxs(k.List,{children:[t.jsx(k.Trigger,{value:"collections",children:e("plugin.tab.collections","Collections")}),t.jsx(k.Trigger,{value:"settings",children:e("plugin.tab.settings","Settings")})]}),t.jsx(k.Content,{value:"collections",children:o&&t.jsx(y,{color:"neutral800",padding:4,background:"neutral0",children:t.jsx(it,{})})}),t.jsx(k.Content,{value:"settings",children:s&&t.jsx(y,{color:"neutral800",padding:4,background:"neutral0",children:t.jsx(ut,{})})})]})},mt=()=>{const{i18n:e}=j();return t.jsx(Fe,{children:t.jsxs(V.Main,{children:[t.jsx(ne.Header,{title:e("plugin.name","Meilisearch"),subtitle:e("plugin.description","Search in your content-types with the Meilisearch plugin"),navigationAction:t.jsx(Oe,{})}),t.jsx(ne.Content,{children:t.jsx(ft,{})})]})})},ht=()=>t.jsx(V.Protect,{permissions:N.main,children:t.jsxs(Ne,{children:[t.jsx(te,{index:!0,element:t.jsx(mt,{})}),t.jsx(te,{path:"*",element:t.jsx(V.Error,{})})]})});export{ht as App};
